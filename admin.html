<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC State - لوحة الإدارة</title>
    <link rel="icon" href="./logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --color-bg-dark: #0a0f14;
            --color-bg-card: rgba(20, 25, 35, 0.95);
            --color-primary: #00d4aa;
            --color-primary-hover: #00f5c4;
            --color-secondary: #8a9197;
            --color-danger: #e74c3c;
            --color-warning: #f39c12;
            --color-success: #2ecc71;
            --color-text-main: #ffffff;
            --color-text-muted: #b0b0b0;
            --font-main: 'Tajawal', sans-serif;
            --font-heading: 'Almarai', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-bg-dark);
            background-image: 
                radial-gradient(ellipse at top, rgba(0, 212, 170, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(0, 212, 170, 0.05) 0%, transparent 50%);
            color: var(--color-text-main);
            font-family: var(--font-main);
            min-height: 100vh;
            direction: rtl;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            right: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--color-bg-card);
            border-left: 1px solid rgba(0, 212, 170, 0.2);
            padding: 20px;
            z-index: 100;
        }

        .sidebar-logo {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0, 212, 170, 0.2);
            margin-bottom: 30px;
        }

        .sidebar-logo img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--color-primary);
        }

        .sidebar-logo h2 {
            color: var(--color-primary);
            font-family: var(--font-heading);
            margin-top: 15px;
            font-size: 1.3rem;
        }

        .sidebar-logo p {
            color: var(--color-text-muted);
            font-size: 0.85rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            border-radius: 10px;
            color: var(--color-text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(0, 212, 170, 0.1);
            color: var(--color-primary);
        }

        .nav-link i {
            font-size: 1.2rem;
            width: 25px;
        }

        .nav-link .badge {
            margin-right: auto;
            background: var(--color-danger);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-content {
            margin-right: 280px;
            padding: 30px;
            min-height: 100vh;
        }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 212, 170, 0.2);
        }

        .page-title {
            font-family: var(--font-heading);
            font-size: 1.8rem;
        }

        .page-title i {
            color: var(--color-primary);
            margin-left: 10px;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 212, 170, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--color-primary);
        }

        .admin-name {
            font-weight: 600;
        }

        .admin-role {
            font-size: 0.8rem;
            color: var(--color-primary);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--color-bg-card);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 212, 170, 0.15);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.users { background: linear-gradient(135deg, #00d4aa, #00a085); }
        .stat-icon.apps { background: linear-gradient(135deg, #f39c12, #d68910); }
        .stat-icon.online { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .stat-icon.money { background: linear-gradient(135deg, #3498db, #2980b9); }

        .stat-info h3 {
            font-size: 1.8rem;
            font-family: var(--font-heading);
        }

        .stat-info p {
            color: var(--color-text-muted);
            font-size: 0.9rem;
        }

        /* Section */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--color-primary);
        }

        /* Table */
        .table-container {
            background: var(--color-bg-card);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 170, 0.15);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 212, 170, 0.15);
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid rgba(0, 212, 170, 0.2);
        }

        .search-box input {
            background: transparent;
            border: none;
            color: white;
            font-family: var(--font-main);
            font-size: 1rem;
            outline: none;
            width: 200px;
        }

        .search-box i {
            color: var(--color-text-muted);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 20px;
            text-align: right;
        }

        th {
            background: rgba(0, 212, 170, 0.1);
            font-weight: 600;
            color: var(--color-primary);
        }

        tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: rgba(0, 212, 170, 0.05);
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-cell img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--color-primary);
        }

        .user-cell .name {
            font-weight: 600;
        }

        .user-cell .discord {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .status-badge.online {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .status-badge.offline {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .status-badge.pending {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
        }

        .status-badge.approved {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .status-badge.rejected {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .action-btn {
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: var(--font-main);
            font-size: 0.85rem;
            transition: all 0.3s ease;
            margin-left: 5px;
        }

        .action-btn.primary {
            background: var(--color-primary);
            color: #000;
        }

        .action-btn.primary:hover {
            background: var(--color-primary-hover);
        }

        .action-btn.danger {
            background: var(--color-danger);
            color: white;
        }

        .action-btn.success {
            background: var(--color-success);
            color: white;
        }

        .action-btn.warning {
            background: var(--color-warning);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-bg-card);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 212, 170, 0.2);
        }

        .modal-header h2 {
            font-family: var(--font-heading);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h2 i {
            color: var(--color-primary);
        }

        .close-btn {
            background: transparent;
            border: none;
            color: var(--color-text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: var(--color-danger);
        }

        /* Player Details */
        .player-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0, 212, 170, 0.1);
            border-radius: 15px;
        }

        .player-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--color-primary);
        }

        .player-header-info h3 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .player-header-info p {
            color: var(--color-text-muted);
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .player-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-stat i {
            font-size: 1.3rem;
            color: var(--color-primary);
            width: 35px;
        }

        .player-stat .label {
            color: var(--color-text-muted);
            font-size: 0.85rem;
        }

        .player-stat .value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .player-vehicles {
            margin-bottom: 25px;
        }

        .player-vehicles h4 {
            margin-bottom: 15px;
            color: var(--color-primary);
        }

        .vehicle-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vehicle-item i {
            color: var(--color-primary);
            margin-left: 10px;
        }

        /* Form Group */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-text-muted);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 170, 0.2);
            border-radius: 10px;
            color: white;
            font-family: var(--font-main);
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-family: var(--font-main);
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--color-primary);
            color: #000;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Access Denied */
        .access-denied {
            text-align: center;
            padding: 100px 20px;
        }

        .access-denied i {
            font-size: 5rem;
            color: var(--color-danger);
            margin-bottom: 30px;
        }

        .access-denied h2 {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .access-denied p {
            color: var(--color-text-muted);
            margin-bottom: 30px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            z-index: 10000;
            animation: slideDown 0.3s ease;
        }

        .notification.success {
            background: var(--color-success);
            color: white;
        }

        .notification.error {
            background: var(--color-danger);
            color: white;
        }

        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
                padding: 15px;
            }
            
            .sidebar-logo h2, .sidebar-logo p, .nav-link span, .nav-link .badge {
                display: none;
            }
            
            .nav-link {
                justify-content: center;
                padding: 15px;
            }
            
            .main-content {
                margin-right: 80px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .player-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <img src="./logo.png" alt="MC State">
            <h2>MC State</h2>
            <p>لوحة الإدارة</p>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>الرئيسية</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('citizens')">
                    <i class="fas fa-users"></i>
                    <span>المواطنين</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('applications')">
                    <i class="fas fa-file-alt"></i>
                    <span>التقديمات</span>
                    <span class="badge" id="apps-badge">0</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="window.location.href='./index.html'">
                    <i class="fas fa-arrow-right"></i>
                    <span>العودة للموقع</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        <!-- سيتم ملؤها بـ JavaScript -->
    </main>

    <!-- Player Details Modal -->
    <div class="modal" id="playerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user"></i> تفاصيل المواطن</h2>
                <button class="close-btn" onclick="closeModal('playerModal')">&times;</button>
            </div>
            <div id="playerDetails">
                <!-- سيتم ملؤها بـ JavaScript -->
            </div>
        </div>
    </div>

    <!-- Transfer Money Modal -->
    <div class="modal" id="transferModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-money-bill-transfer"></i> تحويل فلوس</h2>
                <button class="close-btn" onclick="closeModal('transferModal')">&times;</button>
            </div>
            <div id="transferForm">
                <div class="form-group">
                    <label>المواطن</label>
                    <input type="text" id="transfer-player" readonly>
                </div>
                <div class="form-group">
                    <label>المبلغ</label>
                    <input type="number" id="transfer-amount" placeholder="أدخل المبلغ">
                </div>
                <div class="form-group">
                    <label>نوع التحويل</label>
                    <select id="transfer-type">
                        <option value="add">إضافة فلوس</option>
                        <option value="remove">سحب فلوس</option>
                        <option value="set">تعيين المبلغ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>الحساب</label>
                    <select id="transfer-account">
                        <option value="cash">الكاش</option>
                        <option value="bank">البنك</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('transferModal')">إلغاء</button>
                    <button class="btn btn-primary" onclick="submitTransfer()">تأكيد التحويل</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Job Modal -->
    <div class="modal" id="jobModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-briefcase"></i> تغيير الوظيفة</h2>
                <button class="close-btn" onclick="closeModal('jobModal')">&times;</button>
            </div>
            <div id="jobForm">
                <div class="form-group">
                    <label>المواطن</label>
                    <input type="text" id="job-player" readonly>
                </div>
                <div class="form-group">
                    <label>الوظيفة الحالية</label>
                    <input type="text" id="job-current" readonly>
                </div>
                <div class="form-group">
                    <label>الوظيفة الجديدة</label>
                    <select id="job-new">
                        <option value="عاطل">عاطل</option>
                        <option value="شرطي">شرطي</option>
                        <option value="مسعف">مسعف</option>
                        <option value="ميكانيكي">ميكانيكي</option>
                        <option value="سائق تاكسي">سائق تاكسي</option>
                        <option value="رجل أعمال">رجل أعمال</option>
                        <option value="محامي">محامي</option>
                        <option value="قاضي">قاضي</option>
                        <option value="طبيب">طبيب</option>
                        <option value="صحفي">صحفي</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('jobModal')">إلغاء</button>
                    <button class="btn btn-primary" onclick="submitJobChange()">تغيير الوظيفة</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // قائمة الأدمنز (Discord IDs)
        const ADMIN_IDS = [
            '1234567890', // غيّر هذا بـ Discord ID حقك
            // أضف المزيد هنا
        ];

        let currentUser = null;
        let allCitizens = [];
        let allApplications = [];
        let selectedPlayer = null;

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAccess();
        });

        // التحقق من صلاحية الأدمن
        function checkAdminAccess() {
            const userData = localStorage.getItem('mcstate_user');
            
            if (!userData) {
                showAccessDenied('يجب تسجيل الدخول أولاً');
                return;
            }

            currentUser = JSON.parse(userData);
            
            // للتجربة: السماح لأي مستخدم مسجل
            // في الإنتاج: فعّل التحقق من ADMIN_IDS
            // if (!ADMIN_IDS.includes(currentUser.id)) {
            //     showAccessDenied('ليس لديك صلاحية الوصول لهذه الصفحة');
            //     return;
            // }

            loadData();
            showSection('dashboard');
        }

        // تحميل البيانات
        function loadData() {
            // تحميل المواطنين (من localStorage أو توليد تجريبي)
            const savedCitizens = localStorage.getItem('mcstate_citizens');
            if (savedCitizens) {
                allCitizens = JSON.parse(savedCitizens);
            } else {
                allCitizens = generateDemoCitizens();
                localStorage.setItem('mcstate_citizens', JSON.stringify(allCitizens));
            }

            // تحميل التقديمات
            allApplications = JSON.parse(localStorage.getItem('mcstate_applications') || '[]');
            
            // تحديث badge التقديمات
            const pendingApps = allApplications.filter(a => a.status === 'pending').length;
            document.getElementById('apps-badge').textContent = pendingApps;
        }

        // توليد مواطنين تجريبيين
        function generateDemoCitizens() {
            const names = ['أحمد محمد', 'سعود العتيبي', 'فهد الدوسري', 'عبدالله القحطاني', 'محمد الشمري', 'خالد العنزي'];
            const jobs = ['عاطل', 'شرطي', 'مسعف', 'ميكانيكي', 'سائق تاكسي', 'رجل أعمال'];
            const cars = ['Mercedes S-Class', 'BMW M5', 'Audi RS7', 'Porsche 911', 'Range Rover', 'Toyota Supra'];
            const colors = ['أسود', 'أبيض', 'أحمر', 'أزرق', 'فضي'];

            return names.map((name, i) => ({
                id: `demo_${i + 1}`,
                discordId: `${100000000000000000 + i}`,
                username: name,
                discordName: `player${i + 1}#${1000 + i}`,
                avatar: `https://cdn.discordapp.com/embed/avatars/${i % 5}.png`,
                cash: Math.floor(Math.random() * 100000) + 5000,
                bank: Math.floor(Math.random() * 500000) + 50000,
                job: jobs[i % jobs.length],
                playTime: Math.floor(Math.random() * 500) + 10,
                level: Math.floor(Math.random() * 50) + 1,
                status: Math.random() > 0.5 ? 'online' : 'offline',
                vehicles: [
                    { name: cars[i % cars.length], color: colors[i % colors.length], plate: `MC ${100 + i}` },
                    { name: cars[(i + 2) % cars.length], color: colors[(i + 1) % colors.length], plate: `MC ${200 + i}` }
                ],
                joinDate: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString()
            }));
        }

        // عرض قسم معين
        function showSection(section) {
            // تحديث القائمة
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.closest('.nav-link')?.classList.add('active');

            const mainContent = document.getElementById('main-content');

            switch(section) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'citizens':
                    renderCitizens();
                    break;
                case 'applications':
                    renderApplications();
                    break;
            }
        }

        // عرض الرئيسية
        function renderDashboard() {
            const onlineCount = allCitizens.filter(c => c.status === 'online').length;
            const pendingApps = allApplications.filter(a => a.status === 'pending').length;
            const totalMoney = allCitizens.reduce((sum, c) => sum + c.cash + c.bank, 0);

            document.getElementById('main-content').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</h1>
                    <div class="admin-info">
                        <img src="${currentUser?.avatar || ''}" alt="Admin" class="admin-avatar">
                        <div>
                            <div class="admin-name">${currentUser?.globalName || currentUser?.username || 'Admin'}</div>
                            <div class="admin-role">مدير</div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3>${allCitizens.length}</h3>
                            <p>إجمالي المواطنين</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon online"><i class="fas fa-circle"></i></div>
                        <div class="stat-info">
                            <h3>${onlineCount}</h3>
                            <p>متصل الآن</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon apps"><i class="fas fa-file-alt"></i></div>
                        <div class="stat-info">
                            <h3>${pendingApps}</h3>
                            <p>تقديمات معلقة</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon money"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <h3>$${formatNumber(totalMoney)}</h3>
                            <p>إجمالي الأموال</p>
                        </div>
                    </div>
                </div>

                <h2 class="section-title"><i class="fas fa-clock"></i> آخر المواطنين المسجلين</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>المواطن</th>
                                <th>الوظيفة</th>
                                <th>الحالة</th>
                                <th>تاريخ التسجيل</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allCitizens.slice(0, 5).map(citizen => `
                                <tr>
                                    <td>
                                        <div class="user-cell">
                                            <img src="${citizen.avatar}" alt="${citizen.username}">
                                            <div>
                                                <div class="name">${citizen.username}</div>
                                                <div class="discord">${citizen.discordName}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>${citizen.job}</td>
                                    <td><span class="status-badge ${citizen.status}">${citizen.status === 'online' ? 'متصل' : 'غير متصل'}</span></td>
                                    <td>${formatDate(citizen.joinDate)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // عرض المواطنين
        function renderCitizens() {
            document.getElementById('main-content').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title"><i class="fas fa-users"></i> إدارة المواطنين</h1>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>جميع المواطنين (${allCitizens.length})</h3>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="بحث..." oninput="searchCitizens(this.value)">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>المواطن</th>
                                <th>الوظيفة</th>
                                <th>الكاش</th>
                                <th>البنك</th>
                                <th>ساعات اللعب</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="citizens-table">
                            ${renderCitizensTable(allCitizens)}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // عرض جدول المواطنين
        function renderCitizensTable(citizens) {
            return citizens.map(citizen => `
                <tr>
                    <td>
                        <div class="user-cell">
                            <img src="${citizen.avatar}" alt="${citizen.username}">
                            <div>
                                <div class="name">${citizen.username}</div>
                                <div class="discord">${citizen.discordName}</div>
                            </div>
                        </div>
                    </td>
                    <td>${citizen.job}</td>
                    <td style="color: #2ecc71;">$${formatNumber(citizen.cash)}</td>
                    <td style="color: #3498db;">$${formatNumber(citizen.bank)}</td>
                    <td>${citizen.playTime}h</td>
                    <td><span class="status-badge ${citizen.status}">${citizen.status === 'online' ? 'متصل' : 'غير متصل'}</span></td>
                    <td>
                        <button class="action-btn primary" onclick="viewPlayer('${citizen.id}')">
                            <i class="fas fa-eye"></i> تفاصيل
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // بحث المواطنين
        function searchCitizens(query) {
            const filtered = allCitizens.filter(c => 
                c.username.includes(query) || 
                c.discordName.includes(query) ||
                c.job.includes(query)
            );
            document.getElementById('citizens-table').innerHTML = renderCitizensTable(filtered);
        }

        // عرض تفاصيل اللاعب
        function viewPlayer(id) {
            selectedPlayer = allCitizens.find(c => c.id === id);
            if (!selectedPlayer) return;

            document.getElementById('playerDetails').innerHTML = `
                <div class="player-header">
                    <img src="${selectedPlayer.avatar}" alt="${selectedPlayer.username}">
                    <div class="player-header-info">
                        <h3>${selectedPlayer.username}</h3>
                        <p><i class="fab fa-discord"></i> ${selectedPlayer.discordName}</p>
                        <p>ID: ${selectedPlayer.discordId}</p>
                    </div>
                </div>

                <div class="player-stats">
                    <div class="player-stat">
                        <i class="fas fa-wallet"></i>
                        <div>
                            <div class="label">الكاش</div>
                            <div class="value" style="color: #2ecc71;">$${formatNumber(selectedPlayer.cash)}</div>
                        </div>
                    </div>
                    <div class="player-stat">
                        <i class="fas fa-university"></i>
                        <div>
                            <div class="label">البنك</div>
                            <div class="value" style="color: #3498db;">$${formatNumber(selectedPlayer.bank)}</div>
                        </div>
                    </div>
                    <div class="player-stat">
                        <i class="fas fa-briefcase"></i>
                        <div>
                            <div class="label">الوظيفة</div>
                            <div class="value">${selectedPlayer.job}</div>
                        </div>
                    </div>
                    <div class="player-stat">
                        <i class="fas fa-clock"></i>
                        <div>
                            <div class="label">ساعات اللعب</div>
                            <div class="value">${selectedPlayer.playTime}h</div>
                        </div>
                    </div>
                    <div class="player-stat">
                        <i class="fas fa-star"></i>
                        <div>
                            <div class="label">المستوى</div>
                            <div class="value">${selectedPlayer.level}</div>
                        </div>
                    </div>
                    <div class="player-stat">
                        <i class="fas fa-circle ${selectedPlayer.status === 'online' ? 'text-success' : 'text-danger'}"></i>
                        <div>
                            <div class="label">الحالة</div>
                            <div class="value">${selectedPlayer.status === 'online' ? 'متصل' : 'غير متصل'}</div>
                        </div>
                    </div>
                </div>

                <div class="player-vehicles">
                    <h4><i class="fas fa-car"></i> السيارات (${selectedPlayer.vehicles.length})</h4>
                    ${selectedPlayer.vehicles.map(v => `
                        <div class="vehicle-item">
                            <span><i class="fas fa-car-side"></i> ${v.name}</span>
                            <span>${v.color} | ${v.plate}</span>
                        </div>
                    `).join('')}
                </div>

                <div class="form-actions" style="justify-content: center;">
                    <button class="btn btn-primary" onclick="openTransferModal()">
                        <i class="fas fa-money-bill-transfer"></i> تحويل فلوس
                    </button>
                    <button class="btn btn-secondary" onclick="openJobModal()">
                        <i class="fas fa-briefcase"></i> تغيير الوظيفة
                    </button>
                </div>
            `;

            openModal('playerModal');
        }

        // فتح نافذة التحويل
        function openTransferModal() {
            document.getElementById('transfer-player').value = selectedPlayer.username;
            document.getElementById('transfer-amount').value = '';
            closeModal('playerModal');
            openModal('transferModal');
        }

        // تنفيذ التحويل
        function submitTransfer() {
            const amount = parseInt(document.getElementById('transfer-amount').value);
            const type = document.getElementById('transfer-type').value;
            const account = document.getElementById('transfer-account').value;

            if (!amount || amount <= 0) {
                showNotification('أدخل مبلغ صحيح', 'error');
                return;
            }

            const playerIndex = allCitizens.findIndex(c => c.id === selectedPlayer.id);
            if (playerIndex === -1) return;

            if (type === 'add') {
                allCitizens[playerIndex][account] += amount;
            } else if (type === 'remove') {
                allCitizens[playerIndex][account] = Math.max(0, allCitizens[playerIndex][account] - amount);
            } else {
                allCitizens[playerIndex][account] = amount;
            }

            localStorage.setItem('mcstate_citizens', JSON.stringify(allCitizens));
            closeModal('transferModal');
            showNotification('تم التحويل بنجاح ✅', 'success');
            renderCitizens();
        }

        // فتح نافذة تغيير الوظيفة
        function openJobModal() {
            document.getElementById('job-player').value = selectedPlayer.username;
            document.getElementById('job-current').value = selectedPlayer.job;
            closeModal('playerModal');
            openModal('jobModal');
        }

        // تنفيذ تغيير الوظيفة
        function submitJobChange() {
            const newJob = document.getElementById('job-new').value;

            const playerIndex = allCitizens.findIndex(c => c.id === selectedPlayer.id);
            if (playerIndex === -1) return;

            allCitizens[playerIndex].job = newJob;
            localStorage.setItem('mcstate_citizens', JSON.stringify(allCitizens));
            
            closeModal('jobModal');
            showNotification('تم تغيير الوظيفة بنجاح ✅', 'success');
            renderCitizens();
        }

        // عرض التقديمات
        function renderApplications() {
            document.getElementById('main-content').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title"><i class="fas fa-file-alt"></i> إدارة التقديمات</h1>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>جميع التقديمات (${allApplications.length})</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>المتقدم</th>
                                <th>الوظيفة</th>
                                <th>البريد</th>
                                <th>التاريخ</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allApplications.length > 0 ? allApplications.map((app, i) => `
                                <tr>
                                    <td>${app.name}</td>
                                    <td>${app.position}</td>
                                    <td>${app.email}</td>
                                    <td>${formatDate(app.date)}</td>
                                    <td><span class="status-badge ${app.status || 'pending'}">${getStatusText(app.status)}</span></td>
                                    <td>
                                        ${app.status === 'pending' || !app.status ? `
                                            <button class="action-btn success" onclick="approveApp(${i})">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="action-btn danger" onclick="rejectApp(${i})">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        ` : '-'}
                                    </td>
                                </tr>
                            `).join('') : '<tr><td colspan="6" style="text-align: center; padding: 40px;">لا توجد تقديمات</td></tr>'}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // قبول تقديم
        function approveApp(index) {
            allApplications[index].status = 'approved';
            localStorage.setItem('mcstate_applications', JSON.stringify(allApplications));
            updateAppsBadge();
            renderApplications();
            showNotification('تم قبول التقديم ✅', 'success');
        }

        // رفض تقديم
        function rejectApp(index) {
            allApplications[index].status = 'rejected';
            localStorage.setItem('mcstate_applications', JSON.stringify(allApplications));
            updateAppsBadge();
            renderApplications();
            showNotification('تم رفض التقديم', 'error');
        }

        // تحديث badge التقديمات
        function updateAppsBadge() {
            const pendingApps = allApplications.filter(a => a.status === 'pending' || !a.status).length;
            document.getElementById('apps-badge').textContent = pendingApps;
        }

        // عرض صفحة رفض الوصول
        function showAccessDenied(message) {
            document.getElementById('main-content').innerHTML = `
                <div class="access-denied">
                    <i class="fas fa-ban"></i>
                    <h2>الوصول مرفوض</h2>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="window.location.href='./index.html'">
                        العودة للموقع
                    </button>
                </div>
            `;
        }

        // فتح Modal
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        // إغلاق Modal
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // إشعار
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        // تنسيق الأرقام
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // تنسيق التاريخ
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('ar-SA');
        }

        // نص الحالة
        function getStatusText(status) {
            switch(status) {
                case 'approved': return 'مقبول';
                case 'rejected': return 'مرفوض';
                default: return 'معلق';
            }
        }
    </script>
</body>
</html>
